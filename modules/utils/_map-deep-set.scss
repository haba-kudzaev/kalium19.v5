@use 'sass:map';

@function map-deep-set($map, $keys, $value) {

	$maps  : ($map,);
	$result: null;

	// If the last key is a map already
	// Warn the user we will be overriding it with $value
	@if type-of(nth($keys, -1)) == "map" {
		@warn "üî∂ –ü–æ—Å–ª–µ–¥–Ω–∏–π —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤–∞–º–∏ –∫–ª—é—á ‚Äî —ç—Ç–æ –∫–∞—Ä—Ç–∞; –æ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Å –ø–æ–º–æ—â—å—é `#{$value}`.";
	}

	// If $keys is a single key
	// Just merge and return
	@if length($keys) == 1 {
		@return map-merge($map, ($keys: $value));
	}

	// Loop from the first to the second to last key from $keys
	// Store the associated map to this key in the $maps list
	// If the key doesn't exist, throw an error
	@for $i from 1 through length($keys) - 1 {

		$current-key: nth($keys, $i);
		$current-map: nth($maps, -1);
		$current-get: map-get($current-map, $current-key);

		@if $current-get == null {
			@error "‚õî –ö–ª—é—á `#{$key}` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ –∫–∞—Ä—Ç—ã.";
		}

		$maps: append($maps, $current-get);

	}

	// Loop from the last map to the first one
	// Merge it with the previous one
	@for $i from length($maps) through 1 {

		$current-map: nth($maps, $i);
		$current-key: nth($keys, $i);
		$current-val: if($i == length($maps), $value, $result);

		$result: map-merge($current-map, ($current-key: $current-val));

	}

	@return $result;

}
